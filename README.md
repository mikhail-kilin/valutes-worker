Уже после выполнения задания я нашел решение через chunk_while, но решил оставить свое первое решение)